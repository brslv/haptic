extends layouts/base.layout.pug

include partials/top-bar.pug
include partials/icon.pug
include partials/page-title.pug

block append head_scripts
  script.
    window.___spk___ = "!{stripePublishableKey}";
    window.___selectedPriceId___ = "!{creatorPriceId}";

block content
  +top-bar
  div(class="container mx-auto p-4")
    +page-title Checkout

    div(class="my-4")
      div(class="md:grid grid-cols-1 md:grid-cols-7 gap-4")
        div(class="mb-4 md:mb-0 md:col-span-3")
          span(class="inline-block uppercase text-xs font-medium text-gray-600 mb-2 bg-gray-100 p-1 rounded") Chosen plan
          div(class=" bg-white p-4 rounded-xl border border-gray-100 transition shadow")
            h2(class="font-black text-2xl") Creator
            p(class="font-black text-4xl my-4 text-yellow-300") $10
            p(class="text-gray-600") Per month
            p(class="text-gray-600") Billed monthly
        div(class="col-span-4")
          div(class="bg-white p-4 rounded-xl border border-gray-100 transition shadow-lg hover:shadow-xl")

            if (paymentWentOk) 
              span(class="inline-block uppercase text-xs font-medium text-gray-600 mb-2 bg-gray-100 p-1 rounded mb-4") Payment success
              div(class="text-gray-600 text-2xl font-bold border border-green-400 bg-green-50 rounded-lg p-4 mb-4") Payment went smooth. #[br] Welcome to the creators gang! ðŸŽ‰
              div Now, #[a(href="/dashboard" class="btn btn-small btn-default inline-block") go and create your first product] on Haptic. ðŸš€
                
            else
              span(class="inline-block uppercase text-xs font-medium text-gray-600 mb-2 bg-gray-100 p-1 rounded mb-4") Payment details

              // - Invalid payment config message
              div(class="hidden bg-red-50 border border-red-400 p-4 rounded-lg" data-invalid-payment-config)
                p Invalid/missing payments configuration. Please, refresh the page or contact us if the issue persists.
              div
                form(id="payment-form")
                  div(class="mb-4")
                    label(class="mb-1 label block" for="email")
                      span Billing email
                    input(id="email" type="email" class="input py-3" value=user.email data-billing-email disabled=(user.email))
                    div(id="email-errors" class="text-red-500 text-xs mt-2" role="alert")

                  label(class="label mb-1")
                    span Card details
                    div(id="card-element")
                      span(data-loader class="mr-2")
                        span(class="animate-spin icon-container opacity-75 my-0 inline-block relative")
                          +icon("refresh-cw")
                  div
                    span(data-loader class="hidden mr-2")
                      span(class="animate-pulse icon-container opacity-75 my-0 inline-block relative").
                        Just a sec...processing your payment.
                  div(id="card-element-errors" class="text-red-500 text-xs mt-2" role="alert")
                  button(type="submit" class="flex justify-center btn btn-primary text-lg w-full py-3 mt-4")
                    span(data-loader class="hidden mr-2")
                      span(class="animate-spin icon-container opacity-75 my-0 block relative")
                        +icon("refresh-cw")
                    span(data-submit-button-label) Subscribe
          div(class="flex items-center justify-center mt-2 text-sm")
            if !paymentWentOk
              div Payments powered by #[a(href="https://stripe.com" class="underline font-medium" target="_blank" rel="noopener noreferrer") Stripe]

