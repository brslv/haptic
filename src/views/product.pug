extends layouts/base.layout.pug

include partials/top-bar.pug
include partials/post.pug
include partials/login-modal.pug
include partials/icon.pug
include partials/require-module.pug

block append scripts
  +require-module('product')

block content
  +top-bar
  div(class="bg-white py-32 pb-56 -mt-8 -mb-24")
    div(class="container mx-auto p-4")
      div(class="flex flex-col items-center justify-center" data-product-slug=product.slug data-product-boosts-count=boosts.length)
        if !product.is_public
          div(class="mb-8")
            span(class="flex text-xs flex items-center")
              span(class="mr-2")
                +icon("lock", { width: 18, height: 18 })
              span(class="flex items-center border-b-4 border-purple-400")
                span(class="mr-2") Private
                +icon("info", { width: 12, height: 12 })(data-tippy-content="This product is private, which means that only you can see it. To make it public go to its settings and check the 'Public' checkbox.")
        h1(class="font-bold text-3xl sm:text-5xl mb-4")= product.name
        if product.description
          h2(class="font-medium text-gray-600 text-xl sm:text-2xl text-center" style="max-width: 42ch;")= product.description
        else
          div(class="font-medium text-xl text-gray-600") No product description, yet.
        if product.website
          p(class="flex items-center mt-8")
            a(class="text-yellow-400 underline hover:no-underline font-medium mr-2" href=product.website target="_blank" rel="noreferrer noopener") Visit website
            +icon("external-link", { width: 16, height: 16, stroke: 'primaryDark' })

  div(class="container mx-auto p-4")
    div(class="flex flex-col-reverse md:flex-row items-start")

      main(id="product-main" class="mr-0 w-full md:w-4/6 md:mr-4")
        section(id="product-feed")
          if posts.length
            each post in posts
              - var post_text = post.text;
              // - console.log(post)
              +post({
                author_id: post.user_id,
                comments: post.comments,
                product_slug: product.slug,
                product_name: product.name,
                post_id: post.id,
                post_twitter_text: post.twitter_text,
                img: post.user_twitter_profile_image_url,
                img_url: post.image_url,
                user_type: post.user_type,
                user_slug: post.user_slug,
                twitter_name: post.user_twitter_name,
                twitter_screen_name: post.user_twitter_screen_name,
                date_str: post.created_at_formatted,
                show_opts: false,
                boosts_count: post.boosts_count,
                trigger_login_modal: !user,
                disable_boost_btn: !user,
              }) !{post_text}
          else
            div(class="flex items-center justify-center bg-white shadow p-4 rounded-md border border-gray-100" style="min-height: 300px")
              div(class="rounded-md flex items-center text-gray-500")
                span(class="mr-2 p-2 w-12 h-12 flex items-center justify-center bg-gray-50 rounded-full")
                  +icon("activity", { width: '32', height: '32', stroke: "muted" })
                p(class="text-xl") Still no public updates available

      aside(class="md:w-2/6 mb-16 md:mb-0")
        div(class="p-4 bg-white shadow-sm border border-gray-100 rounded-md mb-4")
          span(class="flex items-center font-medium text-sm mb-4 block")
            span(class="mr-2") Show some love
          nav(id="product-nav")
            ul
              li(class="w-full mb-2")
                div(tabindex="0" role="button" class="product-btn click-scale" data-product-boost-btn data-tippy-content="Boosting shows the creator that you like their project. You're also helping them to reach higher positions in the haptic's rankings." data-disabled=(!user ? 'disabled' : undefined) data-modal-trigger=(!user ? 'login' : undefined))
                  span(class="flex justify-between")
                    span(class="flex items-center")
                      span(class="mr-4")
                        +icon("chevrons-up")
                      span(class="mr-4")= `Boost`
                    span(class="px-4 py-1 bg-yellow-300 font-medium text-gray-800 rounded-full text-xs uppercase" data-product-boost-counter)= boosts.length
              li(class="w-full")
                div(tabindex="0" role="button" class="product-btn click-scale" data-product-collect-btn data-product-slug=product.slug data-tippy-content="Add this product to your collection" data-disabled=(!user ? 'disabled' : undefined) data-modal-trigger=(!user ? 'login' : undefined))
                  span(class="flex justify-between")
                    span(class="flex items-center")
                      span(class="mr-4")
                        +icon("bookmark")
                      span(class="mr-4") Collect

        div(class="p-4 bg-white shadow-sm border border-gray-100 rounded-md mb-4")
          span(class="font-medium text-sm mb-4 block") Creator
          div
            div(class="flex items-start")
              a(href=`/u/${product.user_slug}` title="View profile")
                img(src=product.user_twitter_profile_image_url alt=`Photo of the creator of ${product.name}` class={"w-12 h-12 rounded-full mr-2": true, "border-4 border-double border-yellow-300": product.user_type === USER_TYPES.CREATOR})
              div
                h2(class="font-bold")
                  a(href=`/u/${product.user_slug}` class="underline hover:no-underline" title="View profile")= product.user_twitter_name
                div(class="flex items-center text-xs")
                  +icon("twitter", { width: 10, height: 10, stroke:"twitter", fill: "twitter" })(class="mr-1")
                  span(class="mr-2")= `@${product.user_twitter_screen_name}`
                // div(class="inline-block text-sm text-gray-500 mb-4 font-medium block" )= `@${product.user_twitter_screen_name}`
            p(class="text-gray-600 dark:text-gray-400")= product.user_bio


        if tools.length
          div(class="p-4 bg-white shadow-sm border border-gray-100 rounded-md")
            span(class="font-medium text-sm mb-4 block") Tools
            div(class="flex flex-wrap gap-2")
              each tool of tools
                div(class="px-2 py-1 border border-gray-300 rounded-lg")= tool.text

block modals
  if !user
    +login-modal