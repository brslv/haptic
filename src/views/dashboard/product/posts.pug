extends ../../layouts/base.layout.pug

include ../../partials/top-bar.pug
include ../../partials/product-header.pug
include ../../partials/page-title.pug
include ../../partials/modal.pug
include ../../partials/post.pug
include ../../partials/icon.pug
include ../../partials/require-module.pug

mixin post-type-btn({trigger, icon, disabled, tooltip, text}, attr = {})
  div(
    tabindex="0"
    role="button"
    data-post-type-trigger=trigger
    data-disabled=disabled
    class={
      "relative flex flex-col items-center p-3 rounded-xl outline-none select-none text-center": true,
      "cursor-pointer bg-transparent hover:bg-gray-100 dark:hover:bg-gray-700 click-scale": !disabled,
      "text-gray-300": disabled
    }
    data-tippy-content= tooltip
  )&attributes(attr)
    span(class="mb-1")
      +icon(icon, { width: '18', height: '18', stroke: disabled ? "disabled" : "default" })

    span(class="text-xs text-gray-500")= text
    //- if block
    //-   block
    if disabled
    //- span(class="hidden block absolute -top-2 -right-1 rounded-full bg-gray-100 dark:bg-gray-700 w-5 h-5 icon-container flex items-center justify-center border border-gray-300 dark:border-gray-500" data-close=trigger)
    //-   +icon("x", { width: 14, height: 14 })

block append scripts
  +require-module('posts')

block content
  +top-bar
  div(class="container mx-auto px-4")
    +product-header(product, links, 'posts')
    div(class="flex flex-col md:flex-row items-start pt-4")
      div(class="w-full md:w-4/6 md:mr-4 mb-4")
        +page-title(class="mb-4") Publish new
        div(class="bg-white p-2 mb-4 rounded-xl shadow-sm border-4 border-yellow-300" data-post-types-container)
          div(class="gap-2 flex overflow-y-auto")
            +post-type-btn({ trigger: "short-update", icon: "file-text", disabled: false, text: "Quick Update" })
            +post-type-btn({ trigger: "youtube", icon: "youtube", disabled: true, tooltip: "Soon!", text: "YouTube video" }) 
            +post-type-btn({ trigger: "survey", icon: "check-circle", disabled: true, tooltip: "Soon!", text: "Survey" }) 
            +post-type-btn({ trigger: "milestone", icon: "smile", disabled: true, tooltip: "Soon!", text: "Milestone" }) 
            +post-type-btn({ trigger: "roadmap", icon: "map", disabled: true, tooltip: "Soon!", text: "Roadmap" }) 

          div(data-post-type="short-update" class="hidden")
            form
              input(type="file" id="image-upload" data-upload-file class="hidden")
              input(type="hidden" name="uploaded_image" value="" data-uploaded)
              input(type="hidden" name="id" value=product.id)
              div(class="border border-gray-300 p-1.5 rounded-xl relative mb-2" style="display: none;" data-upload-image-preview)
              label
                textarea(data-autoresize="3" rows="3" class="textarea w-full" placeholder="Share something great about your product..." data-text)
                p(class="hidden text-red-500 font-medium text-sm mb-2" data-error)
              div(class="flex flex-row-reverse items-center justify-between")
                div(class="flex flex-row-reverse items-center")
                  button(type="submit" class="btn btn-primary click-scale") Publish
                  button(type="button" class="mr-2 btn btn-text flex items-center click-scale" data-upload-image-btn)
                    span(class="mr-2")
                      +icon('image', { width: '18', height: '18' })
                    span Attach image
                  span(data-image-upload-loader class="hidden mr-2")
                    span(class="animate-spin icon-container opacity-75 my-0 block relative")
                      +icon("refresh-cw")
                button(data-post-type-cancel type="button" class="btn bg-gray-100 rounded-xl px-2 py-1.5 text-xs flex items-center click-scale")
                  span Quick update
                  +icon("x", { width: 18, height: 18 })(class="ml-2 bg-gray-200 rounded-full p-1")

      
        div
          +page-title(class="mb-4") Posts
          div(data-no-posts-msg class={"hidden": posts.length, "flex items-center justify-center bg-white shadow p-4 rounded-xl border border-gray-100": true} style="min-height: 300px")
            div(class="text-center flex flex-col items-center")
              span(class="mb-2 p-2 w-12 h-12 flex items-center justify-center bg-gray-100 rounded-full")
                +icon("activity", { stroke: "muted" })
              div(class="text-gray-500")
                p(class="mb-2")
                    span No posts available
                div(class="text-xs")
                  p Tip: start simple with a #[button(class="btn btn-small btn-default inline-block" data-post-type-trigger="short-update" data-post-type-trigger-no-hide) quick update]
                  p Share your what's the next small step.
          div(data-posts-container)
            if posts && posts.length
              each post in posts
                - var post_text = post.text
                +post({
                  product_slug: product.slug,
                  product_name: product.name,
                  post_id: post.id,
                  img: post.user_twitter_profile_image_url,
                  img_url: post.image_url,
                  twitter_name: post.user_twitter_name,
                  twitter_screen_name: post.user_twitter_screen_name,
                  date_str: post.created_at_formatted,
                  disable_boost_btn: true,
                  boosts_count: post.boosts_count,
                }) !{post_text}

      div(class="w-full md:w-2/6 mb-4")
        +page-title(class="mb-4") Product details
        // - div(class="relative p-4 bg-yellow-50 rounded-xl mb-4 border border-yellow-300")
        // -   +icon("x", { width: 18, height: 18 })(class="absolute top-0 right-0 m-4 cursor-pointer")
        // -   span(class="font-medium") Tip!
        // -   p Make sure to fill in the most important product details on the side of your product's page. This will help visitors grasp your product in a blink of an eye.
        div(class="p-4 bg-white shadow-sm border border-gray-100 rounded-xl")
          span(class="font-medium text-sm mb-4 block") Tools
          div(data-product-tools-root data-product-tools-product-slug=product.slug)
            div(class={"flex flex-wrap gap-2":true, "mb-2": tools.length} data-product-tools-container)
              each tool of tools
                div(class="px-2 py-1 border border-gray-300 rounded-lg flex items-center justify-between" data-product-tool-id=tool.id)
                  span(class="pr-2")= tool.text
                  +icon("x", { width: 14, height: 14 })(class="cursor-pointer click-scale" data-product-tools-remove-btn)
            button(class="flex items-center btn bg-white bg-yellow-100 hover:bg-yellow-300 btn-small click-scale" data-product-tools-add-btn)
              +icon("plus", { width: 18, height: 18 })(class="mr-2")
              span Add new
            form(data-product-tools-form class="hidden relative mt-4 -mx-4 -mb-4 px-4 py-2 bg-transparent border-t border-gray-100")
              +icon("x", { width: 18, height: 18 })(class="absolute top-0 right-0 m-2 cursor-pointer" data-product-tools-close-btn)
              label(class="label" for="tools-input")
                span Type and hit enter
              input(class="input mb-2" placeholder="E.g. React" id="tools-input" data-product-tools-input)
              button(type="submit" class="hidden") Submit

  template(data-post-tpl)
    +post({
      product_slug: product.slug,
      product_name: product.name,
      post_id: -1,
      img: user.twitter_profile_image_url,
      img_url: null,
      twitter_name: user.twitter_name,
      twitter_screen_name: user.twitter_screen_name,
      date_str: 'Now',
      disable_boost_btn: true,
      boosts_count: 0
    })

  template(data-product-tool-tpl)
    div(class="px-2 py-1 border border-gray-300 rounded-lg flex items-center justify-between" data-product-tool-id="-1")
      span(class="pr-2" data-text-container)
      +icon("x", { width: 14, height: 14 })(class="cursor-pointer click-scale" data-product-tools-remove-btn)
